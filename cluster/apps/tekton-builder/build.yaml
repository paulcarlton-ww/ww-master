apiVersion: v1
kind: Pod
metadata:
  annotations:
    kubernetes.io/psp: eks.privileged
    pipeline.tekton.dev/affinity-assistant: affinity-assistant-1fc09e60a2
    pipeline.tekton.dev/release: 422a468
    tekton.dev/categories: Image Build
    tekton.dev/pipelines.minVersion: 0.12.1
    tekton.dev/platforms: linux/amd64
    tekton.dev/ready: READY
    tekton.dev/tags: image-build
  labels:
    app.kubernetes.io/managed-by: tekton-pipelines
    app.kubernetes.io/version: "0.1"
    kustomize.toolkit.fluxcd.io/name: flux-system
    kustomize.toolkit.fluxcd.io/namespace: flux-system
    tekton.dev/clusterTask: buildkit
    tekton.dev/memberOf: tasks
    tekton.dev/pipeline: build-image
    tekton.dev/pipelineRun: kraan-build
    tekton.dev/pipelineTask: build
    tekton.dev/taskRun: kraan-build-build
  name: kraan-build-build-pod1
  namespace: tekton-builder
spec:
  activeDeadlineSeconds: 5355
  affinity:
    podAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchLabels:
            app.kubernetes.io/component: affinity-assistant
            app.kubernetes.io/instance: affinity-assistant-1fc09e60a2
        topologyKey: kubernetes.io/hostname
  containers:
  - args:
    - -wait_file
    - /tekton/run/0/out
    - -post_file
    - /tekton/run/1/out
    - -termination_path
    - /tekton/termination
    - -step_metadata_dir
    - /tekton/run/1/status
    - -entrypoint
    - buildctl
    - --
    - --debug
    - --addr=buildkit:tcp://buildkitd:1234
    - --tlscacert
    - /certs/ca.pem
    - --tlscert
    - /certs/cert.pem
    - --tlskey
    - /certs/key.pem
    - build
    - --progress=plain
    - --frontend=dockerfile.v0
    - --opt
    - filename=./Dockerfile
    - --local
    - context=.
    - --local
    - dockerfile=.
    - --output
    - type=image,name=pcarlton/kraan:3.0.0-dev,push=true
    - --export-cache
    - type=inline
    - --import-cache
    - type=registry,ref=pcarlton/kraan:3.0.0-dev
    command:
    - /tekton/bin/entrypoint
    image: moby/buildkit:master-rootless
    imagePullPolicy: IfNotPresent
    name: step-build-and-push
    resources: {}
    terminationMessagePath: /tekton/termination
    terminationMessagePolicy: File
    volumeMounts:
    - mountPath: /certs
      name: certs
      readOnly: true
    workingDir: /workspace/source
  dnsPolicy: ClusterFirst
  enableServiceLinks: true
  preemptionPolicy: PreemptLowerPriority
  priority: 0
  restartPolicy: Never
  schedulerName: default-scheduler
  securityContext: {}
  serviceAccount: default
  serviceAccountName: default
  terminationGracePeriodSeconds: 30
  tolerations:
  - effect: NoExecute
    key: node.kubernetes.io/not-ready
    operator: Exists
    tolerationSeconds: 300
  - effect: NoExecute
    key: node.kubernetes.io/unreachable
    operator: Exists
    tolerationSeconds: 300
  volumes:
  - name: certs
    secret:
      defaultMode: 420
      secretName: buildkit-client-certs
